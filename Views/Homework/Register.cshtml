
@{
    ViewData["Title"] = "Register";
}

<h1>Register</h1>

<form name="userInfo" id="form1">
    <div class="mb-3">
        <label for="UserName" class="form-label">UserName</label>
        <input type="text" class="form-control" id="UserName" placeholder="請輸入您的名字" name="Name">
    </div>
    <div id="divDanger" class="alert alert-danger"></div>
    <div class="mb-3">
        <label for="UserName" class="form-label">UserEmail</label>
        <input type="email" class="form-control" id="UserName" placeholder="請輸入您的Email" name="Email">
    </div>
    <div class="mb-3">
        <label for="UserAge" class="form-label">UserAge</label>
        <input type="text" class="form-control" id="UserAge" placeholder="請輸入您的年紀" name="Age">
    </div>
    <div class="mb-3">
        <label for="formFile" class="form-label">選擇檔案</label>
        <input class="form-control" type="file" id="file" name="file">
    </div>
    <button id="btnConfirm" type="submit" class="btn btn-outline-dark">送出</button>
</form>
<div id="divResult" class="alert alert-info"></div>
@section Styles
{
    <style>
        #divDanger{
            display:none;
        }
    </style>
}

@section Scripts{
    <script>
        const UserName = document.querySelector('#UserName')
        const UserEmail = document.querySelector('#UserEmail')
        const divDanger = document.querySelector('#divDanger')
        const divResult = document.querySelector('#divResult')
        const btnConfirm = document.getElementById('btnConfirm');
       const xhr = new XMLHttpRequest()
      
        UserName.addEventListener('blur',()=>{ 
            xhr.open('POST', '/ApiForHomework/CheckValue');
            const formData = new FormData(document.userInfo);
            xhr.send(formData);
            xhr.addEventListener('load',()=>{
            const data = xhr.responseText
                if (data === "true") {
                    divDanger.innerText = "會員已存在"
                    divDanger.style.display = "inline-block"
                    btnConfirm.setAttribute('disabled', 'disabled')
                }
                if (data === "false" || UserName.value ==="") {
                    divDanger.innerText = ""
                    divDanger.style.display = "none"
                    btnConfirm.removeAttribute('disabled')
                }
            }) 
        })

        btnConfirm.addEventListener('click', event => {
            event.preventDefault();
            //設定open時要使用POST方式,並使用ApiController中的getdemo() action
            xhr.open('POST', '/api/register');
            //設定RequestHeader的Content-Type
            const formData = new FormData(document.userInfo); //使用name找到form
            xhr.send(formData);
            xhr.addEventListener('load', () => {
                const data = xhr.responseText
                divResult.innerHTML = data
            })
        })
    </script>
    }